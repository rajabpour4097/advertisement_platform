{% extends "account/account_base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}Ø±Ø²ÙˆÙ…Ù‡ Ù…Ù†{% endblock %}

{% block content %}
<style>
    /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡ */
    .resume-form {
        max-width: 800px;
        margin: 0 auto;
        font-family: sans-serif;
    }

    .resume-form .form-group {
        margin-bottom: 20px;
    }

    .resume-form label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #34495e;
    }

    .resume-form input,
    .resume-form textarea,
    .resume-form select {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 14px;
        box-sizing: border-box;
    }

    .resume-form .row {
        display: flex;
        gap: 20px;
    }

    .resume-form .row > div {
        flex: 1;
    }

    .resume-form button {
        background-color: #028c32;
        color: white;
        padding: 12px 25px;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
        margin-right: 10px;
    }

    .resume-form button:hover {
        background-color: #026a24;
    }

    /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ù†ÙˆØ¹ Ù…Ø¬Ø±ÛŒ - Ø¨Ù‡ÛŒÙ†Ù‡ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ */
    .dealer-type-card-list {
        display: flex;
        gap: 8px;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        padding-bottom: 10px;
        scrollbar-width: thin;
        scrollbar-color: #ccc transparent;
    }

    .dealer-type-card-list::-webkit-scrollbar {
        height: 6px;
    }

    .dealer-type-card-list::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 3px;
    }

    .dealer-type-card-list::-webkit-scrollbar-thumb {
        background: #ccc;
        border-radius: 3px;
    }

    .dealer-type-card {
        position: relative;
        min-width: 100px;
        border: 2px solid #ddd;
        border-radius: 6px;
        padding: 8px;
        cursor: pointer;
        text-align: center;
        transition: all 0.3s ease;
        background-color: #fff;
        min-height: 60px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        flex-shrink: 0;
    }

    .dealer-type-card.selected {
        box-shadow: 0 0 6px rgba(2, 140, 50, 0.3);
        border-color: #028c32;
    }

    .dealer-type-card .icon-wrapper {
        width: 24px;
        height: 24px;
        border-radius: 3px;
        margin: 0 auto 4px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .dealer-type-card img {
        width: 18px;
        height: 18px;
    }

    .dealer-type-card h5 {
        font-weight: bold;
        margin: 0;
        font-size: 10px;
        line-height: 1.2;
    }

    .dealer-type-card .checkmark {
        position: absolute;
        top: 3px;
        left: 3px;
        font-size: 12px;
        color: #028c32;
        display: none;
    }

    .dealer-type-card.selected .checkmark {
        display: block;
    }

    /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø¯Ø§Ù„â€ŒÙ‡Ø§ */
    .modal {
        display: none;
        position: fixed;
        z-index: 9999;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0,0,0,0.5);
    }

    .modal-content {
        background: #fff;
        margin: 20px auto;
        border-radius: 10px;
        padding: 20px;
        position: relative;
        max-width: 90%;
        max-height: 90%;
        overflow-y: auto;
    }

    .portfolio-item {
        border: 1px solid #ddd;
        padding: 10px;
        margin: 5px 0;
        border-radius: 5px;
        display: flex;
        align-items: center;
    }

    .portfolio-item label {
        margin: 0;
        display: flex;
        align-items: center;
        width: 100%;
    }

    .portfolio-item input[type="checkbox"] {
        margin-left: 10px;
        width: auto;
    }

    .custom-file-upload {
        margin-top: 5px;
    }
    
    .file-upload-btn {
        display: flex;
        border-radius: 5px;
        overflow: hidden;
        cursor: pointer;
        border: 1px solid #ccc;
    }
    
    .file-name-display {
        flex-grow: 1;
        padding: 8px 12px;
        background: white;
        color: #666;
        text-align: right;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        font-size: 12px;
    }
    
    .file-select-btn {
        padding: 8px 12px;
        background-color: #3498db;
        color: white;
        font-weight: bold;
        min-width: 90px;
        text-align: center;
        font-size: 12px;
    }

    .char-counter {
        font-size: 12px;
        color: #666;
        text-align: left;
        margin-top: 5px;
    }

    .char-counter.over-limit {
        color: #dc3545;
        font-weight: bold;
    }

    .empty-message {
        color: #666;
        font-style: italic;
        padding: 20px;
        text-align: center;
        background: #f8f9fa;
        border-radius: 5px;
        border: 1px dashed #dee2e6;
    }

    /* Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ */
    @media (max-width: 768px) {
        .container-fluid {
            padding: 10px;
        }

        .x_panel {
            margin: 0;
            padding: 15px;
        }

        .resume-form {
            max-width: 100%;
            padding: 0;
        }

        /* ÙØ±Ù…â€ŒÙ‡Ø§ Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ */
        .resume-form .row {
            flex-direction: column;
            gap: 15px;
        }

        .resume-form input,
        .resume-form textarea,
        .resume-form select {
            padding: 12px;
            font-size: 16px;
        }

        .resume-form button {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            margin-bottom: 10px;
            margin-right: 0;
        }

        /* Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ù†ÙˆØ¹ Ù…Ø¬Ø±ÛŒ Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ - ØªØºÛŒÛŒØ± Ø§Ø² Ø§Ø³Ú©Ø±ÙˆÙ„ÛŒ Ø¨Ù‡ grid */
        .dealer-type-card-list {
            display: grid;
            grid-template-columns: 1fr 1fr; /* 2 Ø³ØªÙˆÙ† */
            gap: 10px;
            overflow-x: visible; /* Ø­Ø°Ù Ø§Ø³Ú©Ø±ÙˆÙ„ Ø§ÙÙ‚ÛŒ */
            padding-bottom: 0;
        }

        .dealer-type-card {
            min-width: auto; /* Ø­Ø°Ù min-width */
            width: 100%; /* Ø¹Ø±Ø¶ Ú©Ø§Ù…Ù„ */
            min-height: 80px;
            padding: 8px;
            flex-shrink: 1; /* Ø§Ø¬Ø§Ø²Ù‡ Ú©ÙˆÚ†Ú© Ø´Ø¯Ù† */
        }

        .dealer-type-card h5 {
            font-size: 10px;
            line-height: 1.2;
        }
        
        .dealer-type-card img {
            width: 18px;
            height: 18px;
        }
        
        .dealer-type-card .icon-wrapper {
            width: 22px;
            height: 22px;
            margin-bottom: 5px;
        }

        /* Ù…Ø¯Ø§Ù„â€ŒÙ‡Ø§ Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ */
        .modal-content {
            margin: 10px;
            max-width: calc(100% - 20px);
            max-height: calc(100% - 20px);
            padding: 15px;
        }

        .modal h4, .modal h5 {
            font-size: 16px;
        }

        /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ */
        button[id*="open-"] {
            width: 100% !important;
            padding: 12px !important;
            font-size: 14px !important;
            margin-bottom: 10px;
        }

        /* ÙØ§ÛŒÙ„ Ø¢Ù¾Ù„ÙˆØ¯ Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ */
        .file-upload-btn {
            flex-direction: column;
        }

        .file-name-display {
            text-align: center;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }

        .file-select-btn {
            min-width: auto;
            width: 100%;
            padding: 12px;
        }

        /* Ù†Ù…Ø§ÛŒØ´ Ø¨Ù‡ØªØ± Ù„ÛŒØ³Øªâ€ŒÙ‡Ø§ Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ */
        .portfolio-item {
            flex-direction: column;
            align-items: stretch;
            padding: 12px;
        }

        .portfolio-item label {
            flex-direction: column;
            align-items: stretch;
        }

        .portfolio-item input[type="checkbox"] {
            margin: 0 0 8px 0;
            width: auto;
            align-self: flex-start;
        }

        /* ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ø³Ú©Ø±ÙˆÙ„ */
        #province-list, 
        #portfolio-list, 
        #permission-list, 
        #worklink-list {
            max-height: 40vh !important;
        }

        /* Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ú©Ø§Ø±Ø§Ú©ØªØ± */
        .char-counter {
            font-size: 11px;
        }

        /* ÙØ§ØµÙ„Ù‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¨Ù‡ØªØ± */
        .form-group {
            margin-bottom: 25px;
        }

        /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ§ÛŒÛŒØ¯/Ø§Ù†ØµØ±Ø§Ù */
        .modal .btn {
            width: 48%;
            margin: 1%;
            padding: 12px;
            font-size: 14px;
        }
    }

    /* Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø±Ø§ÛŒ ØªØ¨Ù„Øª */
    @media (max-width: 992px) and (min-width: 769px) {
        .dealer-type-card {
            min-width: 110px;
        }

        .modal-content {
            max-width: 80%;
        }

        button[id*="open-"] {
            width: 50% !important;
        }
    }

    /* Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ú©ÙˆÚ†Ú© */
    @media (max-width: 480px) {
        .x_panel {
            padding: 10px;
        }

        /* Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø®ÛŒÙ„ÛŒ Ú©ÙˆÚ†Ú©ØŒ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ Ú©Ù…ÛŒ Ú©ÙˆÚ†Ú©â€ŒØªØ± */
        .dealer-type-card {
            min-height: 75px;
            padding: 6px;
        }

        .dealer-type-card h5 {
            font-size: 9px;
        }

        .dealer-type-card img {
            width: 16px;
            height: 16px;
        }

        .dealer-type-card .icon-wrapper {
            width: 20px;
            height: 20px;
        }

        .modal-content {
            margin: 5px;
            padding: 12px;
        }

        .resume-form input,
        .resume-form textarea {
            padding: 14px;
        }
    }

    .iban-wrapper{
    display:inline-flex;
    align-items:center;
    border:1px solid #333;
    border-radius:5px;
    padding:2px 6px 2px 10px;
    width:100%;
    max-width:260px;
    direction:ltr;              /* Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯: ØªØ±ØªÛŒØ¨ Ú†Ù¾ Ø¨Ù‡ Ø±Ø§Ø³Øª Ø¯Ø§Ø®Ù„ ÙÙ‚Ø· Ø§ÛŒÙ† Ø¨Ø§Ú©Ø³ */
}
.iban-prefix{
    /* Ø§Ú¯Ø± Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ú©Ù…â€ŒØªØ± Ø¨Ù‡ Ø±Ø§Ø³Øª Ø¨Ú†Ø³Ø¨Ø¯ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ margin-right ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯ */
    margin-left:3px;
    margin-right:3px;
}
.iban-input{
    direction:ltr;
    text-align:left;
}
#selected-permissions-summary { 
    color:#4ac6e9ff; 
    font-size: 12px;
}
#selected-worklinks-summary  {
    color: #297aebff; 
    font-size: 10px;
}
#selected-cities-summary       { 
    color:#297aebff;
    font-size: 12px;
}
#selected-portfolios-summary   { 
    color:#4ac6e9ff; 
    font-size: 12px;
}

</style>

<!-- Ø¨Ø§Ù‚ÛŒ HTML Ù‡Ù…Ø§Ù†â€ŒØ·ÙˆØ± Ú©Ù‡ Ù‡Ø³Øª -->
<div class="container-fluid">
    <div class="x_panel">
        <div class="x_title">
            <h2>Ø±Ø²ÙˆÙ…Ù‡ Ù…Ù†</h2>
            <div class="clearfix"></div>
        </div>
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
        <div class="x_content">
            {% if resume %}
                <div class="resume-status">
                    ÙˆØ¶Ø¹ÛŒØª Ø±Ø²ÙˆÙ…Ù‡: <p style="display: inline; color: {% if resume.status == 'approved' %}green{% elif resume.status == 'rejected' %}red{% else %}orange{% endif %}">{{ resume.get_status_display }}</p>
                </div>
            {% endif %}

            <form method="post" enctype="multipart/form-data" class="resume-form" id="resume-form">
                {% csrf_token %}

                <!-- Ù†ÙˆØ¹ Ù…Ø¬Ø±ÛŒ ØªØ¨Ù„ÛŒØºØ§Øª Ø¨Ø§ Ú©Ø§Ø±Øª -->
                <div class="form-group">
                    {% for error in form.dealer_type.errors %}
                        <p style="font-size: 10px; color: red;">{{ error }}</p>
                    {% endfor %}
                    <label>Ù†ÙˆØ¹ Ù…Ø¬Ø±ÛŒ ØªØ¨Ù„ÛŒØºØ§Øª (<p style="font-size: 10px; color: red; display: inline;">Ø§Ø¬Ø¨Ø§Ø±ÛŒ</p>)</label>
                    <div class="dealer-type-card-list">
                        {% for topic in parent_topics %}
                            <div class="dealer-type-card {% if form.dealer_type.value == topic.id %}selected{% endif %}" 
                                 data-id="{{ topic.id }}" 
                                 data-color="{{ topic.color|default:'#028c32' }}">
                                {% if topic.icon %}
                                    <div class="icon-wrapper">
                                        <img src="{{ topic.icon.url }}" alt="{{ topic.name }}" />
                                    </div>
                                {% endif %}
                                <h5>{{ topic.name }}</h5>
                                <div class="checkmark">âœ”</div>
                            </div>
                        {% endfor %}
                    </div>
                    <input type="hidden" name="dealer_type" id="selected-dealer-type-id" value="{{ form.dealer_type.value }}">
                </div>

                <!-- Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ÛŒ ØªØ®ØµØµÛŒ -->
                <div class="form-group">
                    {% for error in form.specialty_categories.errors %}
                        <p style="font-size: 10px; color: red;">{{ error }}</p>
                    {% endfor %}
                    <label>Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ÛŒ ØªØ®ØµØµÛŒ (<p style="font-size: 10px; color: red; display: inline;">Ø§Ø¬Ø¨Ø§Ø±ÛŒ</p>)</label>
                    <div id="specialty-categories-container">
                        <div class="empty-message">
                            Ø§Ø¨ØªØ¯Ø§ Ù†ÙˆØ¹ Ù…Ø¬Ø±ÛŒ ØªØ¨Ù„ÛŒØºØ§Øª Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.
                        </div>
                    </div>
                </div>

                <!-- Ø¨Ø®Ø´ Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ø³ØªØ§Ù† Ùˆ Ø´Ù‡Ø±Ù‡Ø§ -->
                <div class="form-group">
                    {% for error in form.service_area.errors %}
                        <p style="font-size: 10px; color: red;">{{ error }}</p>
                    {% endfor %}
                    <label>Ø­ÙˆØ²Ù‡ Ø®Ø¯Ù…Ø§Øª (Ø§Ø³ØªØ§Ù†â€ŒÙ‡Ø§ Ùˆ Ø´Ù‡Ø±Ù‡Ø§)(<p style="font-size: 10px; color: red; display: inline;">Ø§Ø¬Ø¨Ø§Ø±ÛŒ</p>)</label>
                    <button type="button" id="open-city-modal" style="width: 20%; font-size: 12px; background-color: #86a7c9ff;">
                        Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ø³ØªØ§Ù† Ùˆ Ø´Ù‡Ø±
                    </button>
                    <div id="selected-cities-summary" style="margin-top:10px;"></div>
                    <input type="hidden" name="service_area" id="service_area_input">
                </div>

                <div>
                   {% for error in form.describe.errors %}
                       <p style="font-size: 10px; color: red;">{{ error }}</p>
                   {% endfor %}
                    <label for="id_describe">Ù…Ø¹Ø±ÙÛŒ Ú©ÙˆØªØ§Ù‡ Ø®ÙˆØ¯ (<p style="font-size: 10px; color: red; display: inline;">Ø§Ø¬Ø¨Ø§Ø±ÛŒ</p>)</label>
                    <textarea name="describe" id="id_describe" class="form-control" rows="3" 
                              maxlength="300">{{ form.describe.value|default:'' }}</textarea>
                    <div class="char-counter" id="describe-counter">0/300</div>
                </div>

                <div>
                    {% for error in form.services.errors %}
                        <p style="font-size: 10px; color: red;">{{ error }}</p>
                    {% endfor %}
                    <label for="id_services">Ø®Ø¯Ù…Ø§Øª Ù‚Ø§Ø¨Ù„ Ø§Ø±Ø§Ø¦Ù‡ (<p style="font-size: 10px; color: red; display: inline;">Ø§Ø¬Ø¨Ø§Ø±ÛŒ</p>)</label>
                    <textarea name="services" id="id_services" class="form-control" rows="2" 
                              maxlength="120">{{ form.services.value|default:'' }}</textarea>
                    <div class="char-counter" id="services-counter">0/120</div>
                </div>

                <div class="row">
                    <div>
                        <label for="id_socialmedia_and_sites">Ø´Ø¨Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ ÙØ¹Ø§Ù„ÛŒØª (<p style="font-size: 10px; color: blue; display: inline;">Ø§Ø®ØªÛŒØ§Ø±ÛŒ</p>)</label>
                        <textarea name="socialmedia_and_sites" id="id_socialmedia_and_sites" 
                                  class="form-control" rows="2" maxlength="120">{{ form.socialmedia_and_sites.value|default:'' }}</textarea>
                        <div class="char-counter" id="socialmedia-counter">0/120</div>
                    </div>
                    <div>
                        <label for="id_tools_and_platforms">Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ Ùˆ Ù¾Ù„ØªÙØ±Ù…â€ŒÙ‡Ø§ Ù…ÙˆØ±Ø¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ (<p style="font-size: 10px; color: blue; display: inline;">Ø§Ø®ØªÛŒØ§Ø±ÛŒ</p>)</label>
                        <textarea name="tools_and_platforms" id="id_tools_and_platforms" 
                                  class="form-control" rows="2" maxlength="120">{{ form.tools_and_platforms.value|default:'' }}</textarea>
                        <div class="char-counter" id="tools-counter">0/120</div>
                    </div>
                </div>

                <!-- Ø¨Ø®Ø´ Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø±Ù‡Ø§ -->
                <div class="form-group">
                    <label>Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø±Ù‡Ø§ (<p style="font-size: 10px; color: blue; display: inline;">Ø§Ø®ØªÛŒØ§Ø±ÛŒ</p>)</label>
                    <button type="button" id="open-portfolio-modal" class="btn btn-outline-primary" 
                            style="width: 20%; font-size: 12px; background-color: #86a7c9ff;">
                        Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø±
                    </button>
                    <div id="selected-portfolios-summary" style="margin-top:10px;"></div>
                    <input type="hidden" name="portfolios" id="portfolios_input">
                </div>

                <!-- Ø¨Ø®Ø´ Ù…Ø¬ÙˆØ²Ù‡Ø§ -->
                <div class="form-group">
                    <label>Ù…Ø¬ÙˆØ²Ù‡Ø§ Ùˆ Ú¯ÙˆØ§Ù‡ÛŒÙ†Ø§Ù…Ù‡â€ŒÙ‡Ø§ (<p style="font-size: 10px; color: blue; display: inline;">Ø§Ø®ØªÛŒØ§Ø±ÛŒ</p>)</label>
                    <button type="button" id="open-permission-modal" class="btn btn-outline-primary" 
                            style="width: 20%; font-size: 12px; background-color: #86a7c9ff;">
                        Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¬ÙˆØ²Ù‡Ø§
                    </button>
                    <div id="selected-permissions-summary" style="margin-top:10px;"></div>
                    <input type="hidden" name="permissions" id="permissions_input">
                </div>

                <!-- Ø¨Ø®Ø´ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø± -->
                <div class="form-group">
                    <label>Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø± (<p style="font-size: 10px; color: blue; display: inline;">Ø§Ø®ØªÛŒØ§Ø±ÛŒ</p>)</label>
                    <button type="button" id="open-worklink-modal" class="btn btn-outline-primary" 
                            style="width: 20%; font-size: 12px; background-color: #86a7c9ff;">
                        Ù…Ø¯ÛŒØ±ÛŒØª Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§
                    </button>
                    <!-- Ø®Ù„Ø§ØµÙ‡ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡ -->
                    <div class="form-group" style="margin-top:15px;">
                        <label>Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø± Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡</label>
                        <div id="selected-worklinks-summary" style="font-size:13px;color:#555;">Ù‡ÛŒÚ† Ù„ÛŒÙ†Ú©ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</div>
                        <input type="hidden" name="work_links" id="work_links_input">
                    </div>
                </div>

                <div class="row">
                    <div>
                        <label for="id_partner_brand">Ø¨Ø±Ù†Ø¯Ù‡Ø§ÛŒ Ù‡Ù…Ú©Ø§Ø± (<p style="font-size: 10px; color: blue; display: inline;">Ø§Ø®ØªÛŒØ§Ø±ÛŒ</p>)</label>
                        <textarea name="partner_brand" id="id_partner_brand" class="form-control" 
                                  rows="2" maxlength="120">{{ form.partner_brand.value|default:'' }}</textarea>
                        <div class="char-counter" id="partner-counter">0/120</div>
                    </div>
                    <div>
                        {% for error in form.bank_account.errors %}
                             <p style="color: red;">{{ error }}</p>
                        {% endfor %}
                    <label for="id_bank_account">
                        Ø´Ù…Ø§Ø±Ù‡ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù†Ú©ÛŒ (<p style="font-size: 10px; color: red; display: inline;">Ø§Ø¬Ø¨Ø§Ø±ÛŒ</p>)
                    </label>
                    <div class="iban-wrapper">
                        <span class="iban-prefix">IR</span>
                        <input type="text"
                               name="bank_account"
                               id="id_bank_account"
                               class="form-control iban-input"
                               value="{{ form.bank_account.value|default:'' }}"
                               inputmode="numeric"
                               autocomplete="off"
                               maxlength="24"
                               placeholder="24 Ø±Ù‚Ù…">
                    </div>
                </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <label for="id_file">ÙØ§ÛŒÙ„ Ø±Ø²ÙˆÙ…Ù‡ (<p style="font-size: 10px; color: blue; display: inline;">Ø§Ø®ØªÛŒØ§Ø±ÛŒ</p>)</label>
                    
                    <!-- Ù„ÛŒÙ†Ú© Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù†Ù…ÙˆÙ†Ù‡ -->
                    <div style="margin-bottom: 10px; padding: 8px; background-color: #f0f8ff; border-radius: 5px; border: 1px solid #cce7ff;">
                        <a href="{% static 'advplatform/assets/files/sample_cv.pdf' %}" 
                           download="Ù†Ù…ÙˆÙ†Ù‡_Ø±Ø²ÙˆÙ…Ù‡.pdf" 
                           target="_blank"
                           onclick="event.stopPropagation();"
                           style="color: #007bff; text-decoration: none; font-size: 14px; font-weight: bold; cursor: pointer;">
                            ğŸ“„ Ø¯Ø±ÛŒØ§ÙØª Ù†Ù…ÙˆÙ†Ù‡ PDF
                        </a>
                        <small style="color: #666; margin-right: 10px;">
                            (Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ ÙØ±Ù…Øª Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ø±Ø²ÙˆÙ…Ù‡)
                        </small>
                    </div>
                    
                    <div class="custom-file-upload">
                        <input type="file" name="file" id="id_file" class="form-control" 
                               accept=".pdf,.zip" style="display: none;">
                        <div class="file-upload-btn" id="file-upload-button">
                            <div class="file-name-display" id="file-name-display">ÙØ§ÛŒÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ù…Ø§ÛŒÛŒØ¯</div>
                            <div class="file-select-btn">Ø§Ù†ØªØ®Ø§Ø¨ ÙØ§ÛŒÙ„</div>
                        </div>
                    </div>
                    {% if resume and resume.file %}
                        <p style="margin-top: 5px; font-size: 12px;">ÙØ§ÛŒÙ„ ÙØ¹Ù„ÛŒ: <a href="{{ resume.file.url }}" target="_blank">Ù…Ø´Ø§Ù‡Ø¯Ù‡ ÙØ§ÛŒÙ„</a></p>
                    {% endif %}
                </div>

                <div style="margin-top: 30px;">
                    {% if is_edit_mode %}
                        <button type="submit">ÙˆÛŒØ±Ø§ÛŒØ´ Ø±Ø²ÙˆÙ…Ù‡</button>
                    {% else %}
                        <button type="submit">Ø§Ø±Ø³Ø§Ù„ Ø±Ø²ÙˆÙ…Ù‡</button>
                    {% endif %}
                    <a href="{% url 'account:home' %}" class="btn btn-secondary">Ø¨Ø§Ø²Ú¯Ø´Øª</a>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Ù…Ø¯Ø§Ù„â€ŒÙ‡Ø§ Ø¨Ø§ Ú©Ù„Ø§Ø³ Ø¬Ø¯ÛŒØ¯ -->
<div class="modal" id="cityModal">
    <div class="modal-content" style="max-width:500px;">
        <h4 style="margin-bottom:15px;">Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ù‡Ø±</h4>
        <input type="text" id="city-search" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ø´Ù‡Ø±Ù‡Ø§..." class="form-control" style="margin-bottom:15px;">
        <div id="province-list" style="max-height:350px; overflow-y:auto;"></div>
        <div style="margin-top:20px; text-align:center;">
            <button type="button" class="btn btn-success" id="city-modal-confirm">ØªØ§ÛŒÛŒØ¯</button>
            <button type="button" class="btn btn-secondary" id="city-modal-cancel">Ø§Ù†ØµØ±Ø§Ù</button>
        </div>
    </div>
</div>

<!-- Ù…Ø¯Ø§Ù„ Ù…Ø¬ÙˆØ²Ù‡Ø§ -->
<div class="modal" id="permissionModal">
    <div class="modal-content" style="max-width:700px;">
        <h4 style="margin-bottom:15px;">Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¬ÙˆØ²Ù‡Ø§</h4>
        <div id="permission-list" style="max-height:300px; overflow-y:auto;"></div>
        <hr>
        <h5>Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø¬ÙˆØ² Ø¬Ø¯ÛŒØ¯</h5>
        <form id="permission-add-form">
            {% csrf_token %}
            <div class="form-group" style="margin-bottom:15px;">
                <label for="permission_title">Ø¹Ù†ÙˆØ§Ù† Ù…Ø¬ÙˆØ² *</label>
                <input type="text" name="title" id="permission_title" 
                       placeholder="Ù…Ø«Ù„: Ù…Ø¬ÙˆØ² Ú©Ø³Ø¨ØŒ Ú¯ÙˆØ§Ù‡ÛŒÙ†Ø§Ù…Ù‡" class="form-control" required>
            </div>
            
            <div class="form-group" style="margin-bottom:15px;">
                <label for="permission_description">ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
                <textarea name="description" id="permission_description" 
                          placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø¶Ø§ÙÛŒ" class="form-control" rows="2"></textarea>
            </div>
            
            <div class="form-group" style="margin-bottom:15px;">
                <label for="permission_issue_date">ØªØ§Ø±ÛŒØ® ØµØ¯ÙˆØ± *</label>
                <input type="date" name="issue_date" id="permission_issue_date" class="form-control" required>
            </div>
            
            <div class="form-group" style="margin-bottom:15px;">
                <label for="permission_expiry_date">ØªØ§Ø±ÛŒØ® Ø§Ù†Ù‚Ø¶Ø§ *</label>
                <input type="date" name="expiry_date" id="permission_expiry_date" class="form-control" required>
            </div>
            
            <div class="form-group" style="margin-bottom:15px;">
                <label for="permission_issuing_authority">Ù…Ø±Ø¬Ø¹ ØµØ§Ø¯Ø±Ú©Ù†Ù†Ø¯Ù‡ *</label>
                <input type="text" name="issuing_authority" id="permission_issuing_authority" class="form-control" required>
            </div>
            
            <div class="form-group" style="margin-bottom:15px;">
                <label for="permission_file">ÙØ§ÛŒÙ„ Ù…Ø¬ÙˆØ² *</label>
                <input type="file" name="file" id="permission_file" class="form-control" required>
            </div>

            <button type="submit" class="btn btn-success" style="width:100%; margin-bottom:15px;">Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø¬ÙˆØ²</button>
        </form>
        <div style="margin-top:15px; text-align:center;">
            <button type="button" class="btn btn-success" id="permission-modal-confirm">ØªØ§ÛŒÛŒØ¯ Ø§Ù†ØªØ®Ø§Ø¨</button>
            <button type="button" class="btn btn-secondary" id="permission-modal-close">Ø¨Ø³ØªÙ†</button>
        </div>
    </div>
</div>

<!-- Ù…Ø¯Ø§Ù„ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø± -->
<div class="modal" id="portfolioModal" tabindex="-1" style="display:none; position:fixed; z-index:9999; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3);">
    <div style="background:#fff; max-width:700px; margin:40px auto; border-radius:10px; padding:20px; position:relative;">
        <h4 style="margin-bottom:10px;">Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø±</h4>
        <div id="portfolio-list" style="max-height:350px; overflow-y:auto;"></div>
        <hr>
        <h5>Ø§ÙØ²ÙˆØ¯Ù† Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø± Ø¬Ø¯ÛŒØ¯</h5>
        <form id="portfolio-add-form">
            {% csrf_token %}
            <div class="form-group" style="margin-bottom:10px;">
                <label for="portfolio_subject">Ø¹Ù†ÙˆØ§Ù† Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø± *</label>
                <input type="text" name="subject" id="portfolio_subject" 
                       placeholder="Ø¹Ù†ÙˆØ§Ù† Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø±" class="form-control" required>
            </div>
            
            <div class="form-group" style="margin-bottom:10px;">
                <label for="portfolio_description">Ø´Ø±Ø­ Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø±</label>
                <textarea name="description" id="portfolio_description" 
                          placeholder="Ø´Ø±Ø­ Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø±" class="form-control" rows="3"></textarea>
            </div>
            
            <div class="form-group" style="margin-bottom:10px;">
                <label for="portfolio_done_time">ØªØ§Ø±ÛŒØ® Ø§Ù†Ø¬Ø§Ù… *</label>
                <input type="date" name="done_time" id="portfolio_done_time" 
                       class="form-control" required>
            </div>
            
            <div class="form-group" style="margin-bottom:15px;">
                <label for="portfolio_image">ÙØ§ÛŒÙ„ Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø±</label>
                <div class="custom-file-upload">
                    <input type="file" name="image" id="portfolio_image" 
                           class="form-control" accept="image/*,.pdf" style="display: none;">
                    <div class="file-upload-btn" id="portfolio-file-upload-button">
                        <div class="file-name-display" id="portfolio-file-name-display">ÙØ§ÛŒÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ù…Ø§ÛŒÛŒØ¯</div>
                        <div class="file-select-btn">Ø§Ù†ØªØ®Ø§Ø¨ ÙØ§ÛŒÙ„</div>
                    </div>
                </div>
            </div>
            
            <button type="submit" class="btn btn-success" style="margin-bottom:10px;">Ø§ÙØ²ÙˆØ¯Ù† Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø±</button>
        </form>
        
        <div style="margin-top:20px; text-align:left;">
            <button type="button" class="btn btn-success" id="portfolio-modal-confirm">ØªØ§ÛŒÛŒØ¯ Ø§Ù†ØªØ®Ø§Ø¨</button>
            <button type="button" class="btn btn-secondary" id="portfolio-modal-cancel">Ø§Ù†ØµØ±Ø§Ù</button>
        </div>
    </div>
</div>

<!-- Ù…Ø¯Ø§Ù„ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø± -->
<div class="modal" id="worklinkModal" tabindex="-1" 
     style="display:none; position:fixed; z-index:9999; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3);">
    <div style="background:#fff; max-width:700px; margin:40px auto; border-radius:10px; padding:20px; position:relative;">
        <h4 style="margin-bottom:10px;">Ù…Ø¯ÛŒØ±ÛŒØª Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø±</h4>
        <div id="worklink-list" style="max-height:300px; overflow-y:auto;"></div>
        <hr>
        <h5>Ø§ÙØ²ÙˆØ¯Ù† Ù„ÛŒÙ†Ú© Ø¬Ø¯ÛŒØ¯</h5>
        <form id="worklink-add-form">
            {% csrf_token %}
            <div class="form-group" style="margin-bottom:10px;">
                <label for="worklink_title">Ø¹Ù†ÙˆØ§Ù† Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø± *</label>
                <input type="text" name="title" id="worklink_title" 
                       placeholder="Ø¹Ù†ÙˆØ§Ù† Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø±" class="form-control" required>
            </div>
            
            <div class="form-group" style="margin-bottom:10px;">
                <label for="worklink_url">Ø¢Ø¯Ø±Ø³ Ù„ÛŒÙ†Ú© *</label>
                <input type="url" name="url" id="worklink_url" 
                       placeholder="https://example.com" class="form-control" required>
            </div>
            
            <div class="form-group" style="margin-bottom:10px;">
                <label for="worklink_description">ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
                <textarea name="description" id="worklink_description" 
                          placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø±" class="form-control" rows="2"></textarea>
            </div>
            <div class="form-group" style="margin-bottom:10px;">
                <label for="worklink_category">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</label>
                <input type="text" name="category" id="worklink_category" 
                       placeholder="Ù†ÙˆØ¹ Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø± (Ù…Ø«Ù„: ÙˆØ¨â€ŒØ³Ø§ÛŒØªØŒ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†ØŒ Ø·Ø±Ø§Ø­ÛŒ Ú¯Ø±Ø§ÙÛŒÚ©)" class="form-control">
            </div>
            <div class="form-group" style="margin-bottom:10px;">
                <label for="worklink_completion_date">ØªØ§Ø±ÛŒØ® ØªÚ©Ù…ÛŒÙ„</label>
                <input type="date" name="completion_date" id="worklink_completion_date" class="form-control">
            </div>
            <div class="form-group" style="margin-bottom:10px;">
                <label for="worklink_is_featured">Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø± Ø¨Ø±Ø¬Ø³ØªÙ‡</label>
               <input type="checkbox" name="is_featured" id="worklink_is_featured" class="form-control"> 
               Ø¢ÛŒØ§ Ø§ÛŒÙ† Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø± Ø¨Ø±Ø¬Ø³ØªÙ‡ Ø§Ø³ØªØŸ 
            </div>
            <div class="form-group" style="margin-bottom:10px;">
                <label for="worklink_order">ØªØ±ØªÛŒØ¨ Ù†Ù…Ø§ÛŒØ´</label>
                <input type="number" name="order" id="worklink_order" class="form-control" min="1" value="1">
            </div>

            <button type="submit" class="btn btn-success" style="margin-bottom:10px;">Ø§ÙØ²ÙˆØ¯Ù† Ù„ÛŒÙ†Ú©</button>
        </form>
        
        <div style="margin-top:20px; text-align:left;">
            <button type="button" class="btn btn-success" id="worklink-modal-confirm">ØªØ§ÛŒÛŒØ¯ Ø§Ù†ØªØ®Ø§Ø¨</button>
            <button type="button" class="btn btn-secondary" id="worklink-modal-cancel">Ø§Ù†ØµØ±Ø§Ù</button>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø§Ø² Ø³Ø±ÙˆØ±
    const provinces = {{ provinces|safe }};
    let selectedCityIds = {{ selected_cities|safe }};
    let userPortfolios = {{ user_portfolios|safe }};
    let selectedPortfolioIds = {{ selected_portfolios|safe }};
    const dealerTypeId = "{{ dealer_type_id|escapejs }}";
    const selectedSpecialty = {{ selected_specialty_categories|safe }};

    // Ø¢Ø±Ø§ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ù…Ø¬ÙˆØ² Ùˆ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ (Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø² Ø¨Ø¹Ø¯Ø§Ù‹ Ø¨Ø§ AJAX Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯)
    let userPermissions = {{ permissions_json|default:"[]"|safe }};
    let selectedPermissionIds = userPermissions.filter(p => p.is_selected).map(p => p.id);
    let userWorkLinks = {{ work_links_json|default:"[]"|safe }};
    let selectedWorkLinkIds = userWorkLinks.filter(w => w.is_featured).map(w => w.id);  // Ø§Ú¯Ø± Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§Ø¨ØªØ¯Ø§ Ù‡Ù…Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø¨Ø§Ø´Ù†Ø¯: []

    // Ø¹Ù†Ø§ØµØ± Ù…Ø®ÙÛŒ
    const serviceAreaHidden = document.getElementById('service_area_input');
    const portfoliosHidden = document.getElementById('portfolios_input');
    const permissionsHidden = document.getElementById('permissions_input');
    const workLinksHidden = document.getElementById('work_links_input');

    // Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ù‚Ø¨Ù„Ø§Ù‹ Ø´Ù‡Ø±Ù‡Ø§ Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ø±Ø¯Ù‡
    if (serviceAreaHidden && serviceAreaHidden.value.trim() !== '') {
        selectedCityIds = serviceAreaHidden.value.split(',').filter(x => x).map(x => parseInt(x));
    }

    /* ---------- Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ú©Ø§Ø±Ø§Ú©ØªØ± ---------- */
    function setupCharacterCounter(fieldId, counterId, maxLength) {
        const field = document.getElementById(fieldId);
        const counter = document.getElementById(counterId);
        if (!field || !counter) return;
        function update() {
            const l = field.value.length;
            counter.textContent = l + '/' + maxLength;
            counter.classList.toggle('over-limit', l > maxLength);
        }
        field.addEventListener('input', update);
        update();
    }
    setupCharacterCounter('id_describe', 'describe-counter', 250);
    setupCharacterCounter('id_services', 'services-counter', 120);
    setupCharacterCounter('id_socialmedia_and_sites', 'socialmedia-counter', 120);
    setupCharacterCounter('id_tools_and_platforms', 'tools-counter', 120);
    setupCharacterCounter('id_partner_brand', 'partner-counter', 120);

    /* ---------- Ù†ÙˆØ¹ Ù…Ø¬Ø±ÛŒ Ùˆ Ø¯Ø³ØªÙ‡ ØªØ®ØµØµÛŒ ---------- */
    const dealerTypeCards = document.querySelectorAll(".dealer-type-card");
    const hiddenDealerInput = document.getElementById("selected-dealer-type-id");
    const specialtyCategoriesContainer = document.getElementById('specialty-categories-container');

    function resetDealerCards() {
        dealerTypeCards.forEach(c => c.classList.remove('selected'));
    }

    function loadSpecialtyCategories(dealerTypeId) {
        if (!dealerTypeId) {
            specialtyCategoriesContainer.innerHTML = '<div class="empty-message">Ø§Ø¨ØªØ¯Ø§ Ù†ÙˆØ¹ Ù…Ø¬Ø±ÛŒ ØªØ¨Ù„ÛŒØºØ§Øª Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.</div>';
            return;
        }
        specialtyCategoriesContainer.innerHTML = '<div class="empty-message">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>';
        fetch(`/account/get-specialty-categories/?dealer_type_id=${dealerTypeId}`)
            .then(r => r.json())
            .then(data => {
                if (!data.categories || data.categories.length === 0) {
                    specialtyCategoriesContainer.innerHTML = '<div class="empty-message">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ ØªØ®ØµØµÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</div>';
                    return;
                }
                specialtyCategoriesContainer.innerHTML = '';
                data.categories.forEach(cat => {
                    const div = document.createElement('div');
                    div.style.marginLeft = '15px';
                    div.innerHTML = `
                        <label>
                            <input type="radio" name="specialty_categories" value="${cat.id}">
                            ${cat.name}
                        </label>
                    `;
                    specialtyCategoriesContainer.appendChild(div);
                });
                if (selectedSpecialty.length) {
                    const r = specialtyCategoriesContainer.querySelector(`input[value="${selectedSpecialty[0]}"]`);
                    if (r) r.checked = true;
                }
            })
            .catch(() => {
                specialtyCategoriesContainer.innerHTML = '<div class="empty-message">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ.</div>';
            });
    }

    dealerTypeCards.forEach(card => {
        card.addEventListener('click', () => {
            resetDealerCards();
            card.classList.add('selected');
            hiddenDealerInput.value = card.dataset.id;
            loadSpecialtyCategories(card.dataset.id);
        });
        if (card.classList.contains('selected')) {
            loadSpecialtyCategories(card.dataset.id);
        }
    });
    if (hiddenDealerInput.value) loadSpecialtyCategories(hiddenDealerInput.value);

    /* ---------- Ù…Ø¯ÛŒØ±ÛŒØª Ø´Ù‡Ø±Ù‡Ø§ ---------- */
    function updateProvinceCheckboxStates() {
        provinces.forEach(prov => {
            const cb = document.querySelector(`.province-all[data-province="${prov.id}"]`);
            if (!cb) return;
            const ids = prov.cities.map(c => c.id);
            const selectedIn = ids.filter(id => selectedCityIds.includes(id));
            if (selectedIn.length === 0) {
                cb.checked = false;
                cb.indeterminate = false;
            } else if (selectedIn.length === ids.length) {
                cb.checked = true;
                cb.indeterminate = false;
            } else {
                cb.checked = false;
                cb.indeterminate = true;
            }
        });
    }

    function renderProvinceList(filter = "") {
        const container = document.getElementById('province-list');
        container.innerHTML = '';
        provinces.forEach(prov => {
            const filteredCities = prov.cities.filter(c => c.name.includes(filter));
            if (filter && filteredCities.length === 0 && !prov.name.includes(filter)) return;
            const wrap = document.createElement('div');
            wrap.style.marginBottom = '10px';
            wrap.innerHTML = `
              <div style="display:flex;align-items:center;justify-content:space-between;cursor:pointer;">
                <div>
                  <input type="checkbox" class="province-all" data-province="${prov.id}">
                  <span style="font-weight:bold;">${prov.name}</span>
                </div>
                <span class="toggle-cities" data-province="${prov.id}" style="font-size:18px;cursor:pointer;">&#x25BC;</span>
              </div>
              <div class="cities-list" id="cities-list-${prov.id}" style="display:none; margin-right:20px; margin-top:5px;"></div>
            `;
            container.appendChild(wrap);
            const citiesList = wrap.querySelector('.cities-list');
            prov.cities.forEach(city => {
                const div = document.createElement('div');
                div.innerHTML = `
                  <label style="display:flex;align-items:center;">
                    <input type="checkbox" class="city-checkbox" data-city="${city.id}" data-province="${prov.id}" ${selectedCityIds.includes(city.id) ? 'checked' : ''}>
                    <span>${city.name}</span>
                  </label>`;
                citiesList.appendChild(div);
            });
            wrap.querySelector('.toggle-cities').onclick = function() {
                citiesList.style.display = citiesList.style.display === 'none' ? 'block' : 'none';
                this.innerHTML = citiesList.style.display === 'none' ? '&#x25BC;' : '&#x25B2;';
            };
            wrap.querySelector('.province-all').onclick = function() {
                const checked = this.checked;
                citiesList.querySelectorAll('.city-checkbox').forEach(cb => {
                    const cid = parseInt(cb.dataset.city);
                    cb.checked = checked;
                    if (checked && !selectedCityIds.includes(cid)) selectedCityIds.push(cid);
                    if (!checked) selectedCityIds = selectedCityIds.filter(id => id !== cid);
                });
                updateProvinceCheckboxStates();
            };
        });
        updateProvinceCheckboxStates();
    }

    function syncCitySummary() {
        const names = [];
        provinces.forEach(p => p.cities.forEach(c => {
            if (selectedCityIds.includes(c.id)) names.push(c.name);
        }));
        document.getElementById('selected-cities-summary').textContent =
            names.length ? names.join('ØŒ ') : 'Ù‡ÛŒÚ† Ø´Ù‡Ø±ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª';
        serviceAreaHidden.value = selectedCityIds.join(',');
    }

    document.getElementById('open-city-modal')?.addEventListener('click', () => {
        document.getElementById('cityModal').style.display = 'block';
        renderProvinceList();
    });
    document.getElementById('city-modal-cancel')?.addEventListener('click', () => {
        document.getElementById('cityModal').style.display = 'none';
    });
    document.getElementById('city-search')?.addEventListener('input', function() {
        renderProvinceList(this.value.trim());
    });
    document.getElementById('city-modal-confirm')?.addEventListener('click', () => {
        // Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø§Ø² Ú†Ú©â€ŒØ¨Ø§Ú©Ø³â€ŒÙ‡Ø§
        const arr = [];
        document.querySelectorAll('.city-checkbox:checked').forEach(cb => {
            arr.push(parseInt(cb.dataset.city));
        });
        selectedCityIds = arr;
        syncCitySummary();
        document.getElementById('cityModal').style.display = 'none';
    });
    document.addEventListener('change', e => {
        if (e.target.classList.contains('city-checkbox')) {
            const cid = parseInt(e.target.dataset.city);
            if (e.target.checked) {
                if (!selectedCityIds.includes(cid)) selectedCityIds.push(cid);
            } else {
                selectedCityIds = selectedCityIds.filter(id => id !== cid);
            }
            updateProvinceCheckboxStates();
        }
    });

    // Ù…Ù‚Ø¯Ø§Ø± Ø§ÙˆÙ„ÛŒÙ‡ Ø´Ù‡Ø±Ù‡Ø§
    syncCitySummary();

    /* ---------- Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø± ---------- */
    function renderPortfolioList() {
        const container = document.getElementById('portfolio-list');
        container.innerHTML = '';
        if (userPortfolios.length === 0) {
            container.innerHTML = '<div class="empty-message">Ø´Ù…Ø§ Ù‡Ù†ÙˆØ² Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø±ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯.</div>';
            return;
        }
        userPortfolios.forEach(p => {
            const div = document.createElement('div');
            div.className = 'portfolio-item';
            div.innerHTML = `
              <label>
                <input type="checkbox" class="portfolio-checkbox-input" data-portfolio="${p.id}" ${selectedPortfolioIds.includes(p.id) ? 'checked' : ''}>
                <div>
                  <strong>${p.subject || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†'}</strong><br>
                  <small>${p.description || ''}</small>
                </div>
              </label>`;
            container.appendChild(div);
        });
    }

    function syncPortfolioSummary() {
        const names = [];
        userPortfolios.forEach(p => {
            if (selectedPortfolioIds.includes(p.id)) names.push(p.subject || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†');
        });
        document.getElementById('selected-portfolios-summary').textContent =
            names.length ? names.join('ØŒ ') : 'Ù‡ÛŒÚ† Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø±ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª';
        portfoliosHidden.value = selectedPortfolioIds.join(',');
    }

    document.getElementById('open-portfolio-modal')?.addEventListener('click', () => {
        document.getElementById('portfolioModal').style.display = 'block';
        renderPortfolioList();
    });
    document.getElementById('portfolio-modal-cancel')?.addEventListener('click', () => {
        document.getElementById('portfolioModal').style.display = 'none';
    });
    document.getElementById('portfolio-modal-confirm')?.addEventListener('click', () => {
        const arr = [];
        document.querySelectorAll('.portfolio-checkbox-input:checked').forEach(cb => {
            arr.push(parseInt(cb.dataset.portfolio));
        });
        selectedPortfolioIds = arr;
        syncPortfolioSummary();
        document.getElementById('portfolioModal').style.display = 'none';
    });

    // Ø§ÙØ²ÙˆØ¯Ù† Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø± Ø¬Ø¯ÛŒØ¯ (AJAX)
    const portfolioAddForm = document.getElementById('portfolio-add-form');
    if (portfolioAddForm) {
        portfolioAddForm.addEventListener('submit', e => {
            e.preventDefault();
            const fd = new FormData(portfolioAddForm);
            if (!fd.get('subject') || !fd.get('done_time')) {
                alert('Ø¹Ù†ÙˆØ§Ù† Ùˆ ØªØ§Ø±ÛŒØ® Ø§Ù†Ø¬Ø§Ù… Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª.');
                return;
            }
            fetch('/account/portfolio/ajax-add/', {
                method: 'POST',
                body: fd,
                headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                }
            })
            .then(r => r.json())
            .then(data => {
                if (data.success) {
                    userPortfolios.push(data.portfolio);
                    renderPortfolioList();
                    portfolioAddForm.reset();
                    document.getElementById('portfolio-file-name-display').textContent = 'ÙØ§ÛŒÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ù…Ø§ÛŒÛŒØ¯';
                    alert('Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø± Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.');
                } else {
                    alert(data.error || 'Ø®Ø·Ø§ Ø¯Ø± Ø§ÙØ²ÙˆØ¯Ù† Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø±');
                }
            })
            .catch(() => alert('Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡'));
        });
    }
    syncPortfolioSummary();

    /* ---------- Ù…Ø¬ÙˆØ²Ù‡Ø§ (ÙØ±Ø§Ù†Øª ÙÙ‚Ø·) ---------- */
    function renderPermissionList() {
        const container = document.getElementById('permission-list');
        container.innerHTML = '';
        if (userPermissions.length === 0) {
            container.innerHTML = '<div class="empty-message">Ù‡ÛŒÚ† Ù…Ø¬ÙˆØ²ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>';
            return;
        }
        userPermissions.forEach((perm, idx) => {
            const div = document.createElement('div');
            div.className = 'portfolio-item';
            div.innerHTML = `
              <label style="display:flex;align-items:center;gap:10px;width:100%;cursor:pointer;">
                <input type="checkbox" class="permission-checkbox" data-permission="${perm.id}" ${selectedPermissionIds.includes(perm.id) ? 'checked' : ''} style="width:auto;">
                <div style="flex:1;">
                  <strong>${perm.title}</strong><br>
                  <small>${perm.description || ''}</small>
                </div>
                <button type="button" class="btn btn-sm btn-danger permission-remove-btn" data-index="${idx}" style="min-width:60px;">Ø­Ø°Ù</button>
              </label>`;
            container.appendChild(div);
        });
    }
    function syncPermissions() {
        permissionsHidden.value = selectedPermissionIds.join(',');
        const sum = document.getElementById('selected-permissions-summary');
        if (!sum) return;
        if (!selectedPermissionIds.length) {
            sum.textContent = 'Ù‡ÛŒÚ† Ù…Ø¬ÙˆØ²ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª';
            return;
        }
        const names = userPermissions.filter(p => selectedPermissionIds.includes(p.id)).map(p => p.title);
        sum.textContent = names.join('ØŒ ');
    }
    document.getElementById('open-permission-modal')?.addEventListener('click', () => {
        document.getElementById('permissionModal').style.display = 'block';
        renderPermissionList();
    });
    document.getElementById('permission-modal-close')?.addEventListener('click', () => {
        document.getElementById('permissionModal').style.display = 'none';
    });
    document.getElementById('permission-modal-confirm')?.addEventListener('click', () => {
        syncPermissions();
        document.getElementById('permissionModal').style.display = 'none';
    });
    document.addEventListener('change', e => {
        if (e.target.classList.contains('permission-checkbox')) {
            const id = parseInt(e.target.dataset.permission);
            if (e.target.checked) {
                if (!selectedPermissionIds.includes(id)) selectedPermissionIds.push(id);
            } else {
                selectedPermissionIds = selectedPermissionIds.filter(x => x !== id);
            }
            syncPermissions();
        }
    });
    document.addEventListener('click', e => {
        if (e.target.classList.contains('permission-remove-btn')) {
            const idx = parseInt(e.target.dataset.index);
            const removed = userPermissions.splice(idx, 1)[0];
            selectedPermissionIds = selectedPermissionIds.filter(x => x !== removed.id);
            renderPermissionList();
            syncPermissions();
        }
    });
    const permissionAddForm = document.getElementById('permission-add-form');
    if (permissionAddForm) {
        permissionAddForm.addEventListener('submit', e => {
            e.preventDefault();
            const fd = new FormData(permissionAddForm);
            fetch("{% url 'account:permission_ajax_add' %}", {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: fd
            })
            .then(r => r.json())
            .then(data => {
                if (!data.ok) {
                    alert(data.error || 'Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Ù…Ø¬ÙˆØ²');
                    return;
                }
                const perm = data.permission;
                userPermissions.unshift(perm);
                if (!selectedPermissionIds.includes(perm.id)) selectedPermissionIds.push(perm.id);
                renderPermissionList();
                syncPermissions();
                permissionAddForm.reset();
                alert('Ù…Ø¬ÙˆØ² Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
            })
            .catch(() => alert('Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡'));
        });
    }
    syncPermissions();

    /* ---------- Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø± (ÙØ±Ø§Ù†Øª) ---------- */
    function renderWorkLinkList() {
        const container = document.getElementById('worklink-list');
        if (!container) return;
        container.innerHTML = '';
        if (userWorkLinks.length === 0) {
            container.innerHTML = '<div class="empty-message">Ù‡ÛŒÚ† Ù„ÛŒÙ†Ú© Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø±ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>';
            return;
        }
        userWorkLinks
            .sort((a,b)=> (a.order||0) - (b.order||0) || a.id - b.id)
            .forEach((wl, idx) => {
                const checked = selectedWorkLinkIds.includes(wl.id) ? 'checked' : '';
                const div = document.createElement('div');
                div.className = 'portfolio-item';
                div.style.display = 'flex';
                div.style.alignItems = 'flex-start';
                div.style.gap = '10px';
                div.innerHTML = `
                  <label style="margin:0;display:flex;align-items:flex-start;gap:8px;cursor:pointer;flex:1;">
                    <input type="checkbox" class="worklink-checkbox" data-worklink="${wl.id}" ${checked} style="margin-top:4px;">
                    <div style="flex:1;">
                        <strong>${wl.title}</strong>
                        ${wl.is_featured ? '<span style="color:#d58512;font-size:11px;">(Ø¨Ø±Ø¬Ø³ØªÙ‡)</span>' : ''}
                        <br>
                        <small><a href="${wl.url}" target="_blank">${wl.url}</a></small><br>
                        ${wl.category ? `<small>Ø¯Ø³ØªÙ‡: ${wl.category}</small><br>` : ''}
                        ${wl.completion_date ? `<small>ØªØ§Ø±ÛŒØ®: ${wl.completion_date}</small><br>` : ''}
                        ${wl.description ? `<small>${wl.description}</small>` : ''}
                    </div>
                  </label>
                  <button type="button" class="btn btn-sm btn-danger worklink-remove-btn" data-index="${idx}">Ø­Ø°Ù</button>
                `;
                container.appendChild(div);
            });
    }

    function syncWorkLinks() {
        // ÙÙ‚Ø· Ø¢ÛŒØ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡ Ø±Ø§ Ø¯Ø± hidden Ù†Ú¯Ù‡ Ø¯Ø§Ø±ÛŒÙ…
        const hidden = document.getElementById('work_links_input');
        if (hidden) hidden.value = selectedWorkLinkIds.join(',');
        const sum = document.getElementById('selected-worklinks-summary');
        if (sum) {
            if (!selectedWorkLinkIds.length) {
                sum.textContent = 'Ù‡ÛŒÚ† Ù„ÛŒÙ†Ú©ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª';
            } else {
                const titles = userWorkLinks
                    .filter(w => selectedWorkLinkIds.includes(w.id))
                    .map(w => w.title);
                sum.textContent = titles.join('ØŒ ');
            }
        }
    }

    // Ø±ÙˆÛŒØ¯Ø§Ø¯ ØªØºÛŒÛŒØ± ØªÛŒÚ© Ù„ÛŒÙ†Ú©
    document.addEventListener('change', e => {
        if (e.target.classList.contains('worklink-checkbox')) {
            const id = parseInt(e.target.getAttribute('data-worklink'));
            if (e.target.checked) {
                if (!selectedWorkLinkIds.includes(id)) selectedWorkLinkIds.push(id);
            } else {
                selectedWorkLinkIds = selectedWorkLinkIds.filter(x => x !== id);
            }
            syncWorkLinks();
        }
    });

    // Ù‡Ù†Ú¯Ø§Ù… Ø§ÙØ²ÙˆØ¯Ù† Ù„ÛŒÙ†Ú© Ø¬Ø¯ÛŒØ¯ Ø§Ø² AJAX
    // Ø¯Ø§Ø®Ù„ then(data => { ... }) Ø¨Ø¹Ø¯ Ø§Ø² push(wl):
    // if (!selectedWorkLinkIds.includes(wl.id)) selectedWorkLinkIds.push(wl.id);
    // renderWorkLinkList(); syncWorkLinks();

    // Ù¾Ø³ Ø§Ø² Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
    renderWorkLinkList();
    syncWorkLinks();

    /* ---------- Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ Ø±Ø²ÙˆÙ…Ù‡ ---------- */
    const fileInput = document.getElementById('id_file');
    const fileUploadBtn = document.getElementById('file-upload-button');
    const fileNameDisp = document.getElementById('file-name-display');
    if (fileUploadBtn && fileInput) {
        fileUploadBtn.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', () => {
            fileNameDisp.textContent = fileInput.files?.[0]?.name || 'ÙØ§ÛŒÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ù…Ø§ÛŒÛŒØ¯';
        });
    }

    /* ---------- Ù…Ù‚Ø¯Ø§Ø± Ø§ÙˆÙ„ÛŒÙ‡ Ø®Ù„Ø§ØµÙ‡â€ŒÙ‡Ø§ ---------- */
    syncPortfolioSummary();
    syncPermissions();
    syncWorkLinks();

    // --- Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ù…Ø¯Ø§Ù„ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø± ---
    const openWorkLinkModalBtn = document.getElementById('open-worklink-modal');
    const workLinkModal = document.getElementById('worklinkModal');
    const workLinkConfirmBtn = document.getElementById('worklink-modal-confirm');
    const workLinkCancelBtn = document.getElementById('worklink-modal-cancel');

    if (openWorkLinkModalBtn && workLinkModal) {
        openWorkLinkModalBtn.addEventListener('click', () => {
            renderWorkLinkList();
            workLinkModal.style.display = 'block';
        });
    }

    if (workLinkCancelBtn && workLinkModal) {
        workLinkCancelBtn.addEventListener('click', () => {
            workLinkModal.style.display = 'none';
        });
    }

    if (workLinkConfirmBtn && workLinkModal) {
        workLinkConfirmBtn.addEventListener('click', () => {
            // Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§ (Ø¯Ø± ØµÙˆØ±Øª ØªØºÛŒÛŒØ± Ø¯Ø³ØªÛŒ)
            const arr = [];
            document.querySelectorAll('.worklink-checkbox:checked').forEach(cb => {
                arr.push(parseInt(cb.dataset.worklink));
            });
            selectedWorkLinkIds = arr;
            syncWorkLinks();
            workLinkModal.style.display = 'none';
        });
    }

    // ÙØ±Ù… Ø§ÙØ²ÙˆØ¯Ù† Ù„ÛŒÙ†Ú© Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ AJAX (Ø§Ú¯Ø± Ù‚Ø¨Ù„Ø§Ù‹ Ù†Ø¯Ø§Ø±ÛŒØ¯)
    const worklinkAddForm = document.getElementById('worklink-add-form');
    if (worklinkAddForm) {
        worklinkAddForm.addEventListener('submit', e => {
            e.preventDefault();
            const fd = new FormData(worklinkAddForm);
            fetch("{% url 'account:worklink_ajax_add' %}", {
                method: 'POST',
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
                body: fd
            })
            .then(r => r.json())
            .then(data => {
                if (!data.ok) {
                    alert(data.error || 'Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Ù„ÛŒÙ†Ú©');
                    return;
                }
                const wl = data.worklink;
                userWorkLinks.push(wl);
                if (!selectedWorkLinkIds.includes(wl.id)) selectedWorkLinkIds.push(wl.id);
                renderWorkLinkList();
                syncWorkLinks();
                worklinkAddForm.reset();
                alert('Ù„ÛŒÙ†Ú© Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
            })
            .catch(()=>alert('Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡'));
        });
    }

    const bankInput = document.getElementById('id_bank_account');
    if (bankInput) {
        function sanitizeBank(){
            let v = bankInput.value.replace(/\D/g,''); // ÙÙ‚Ø· Ø±Ù‚Ù…
            if (v.length > 24) v = v.slice(0,24);
            bankInput.value = v;
        }
        sanitizeBank();
        bankInput.addEventListener('input', sanitizeBank);
        bankInput.addEventListener('paste', e=>{
            setTimeout(sanitizeBank,0);
        });
    }
});
</script>

{% endblock %}